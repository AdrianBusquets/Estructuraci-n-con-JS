let anuncios= 
    [
        {
            "id":1,
            "name": "Huawei X5",
            "category": "Electronica",
            "price": "120.12",
            "type" : "sell"
        },
        {
            "id": 2,
            "name": "Fiat 500",
            "category": "Coche",
            "price": "2000.32",
            "type" : "search"
        },
        {
            "id": 3,
            "name": "Mazza da Baseball",
            "category": "Deporte",
            "price": "20.15",
            "type" : "sell"
        },
        {
            "id": 4,
            "name": "Bilocale",
            "category": "Casa",
            "price": "30000.54",
            "type" : "search"
        },
        {
            "id": 5,
            "name": "Felpa usata",
            "category": "Ropa",
            "price": "10.42",
            "type" : "sell"
        },
        {
            "id": 6,
            "name": "Divani due posti",
            "category": "Casa",
            "price":"400.64",
            "type" : "search"
        },
        {
            "id": 7,
            "name": "Pala",
            "category": "Jardineria",
            "price":"30.45",
            "type" : "sell"
        },
        {
            "id": 8,
            "name": "Master of Pupo",
            "category": "Musica",
            "price": "15.64",
            "type" : "sell"
        },
        {
            "id": 9,
            "name": "TV Samsung",
            "category": "Electronica",
            "price": "230.42",
            "type" : "sell"
        },
        {
            "id": 10,
            "name": "Ford Puma",
            "category": "Coche",
            "price": "25000.02",
            "type" : "sell"
        },
        {
            "id": 11,
            "name": "Pallone da calcio",
            "category": "Deporte",
            "price": "30.12",
            "type" : "search"
        },
        {
            "id": 12,
            "name": "Trilocale",
            "category": "Casa",
            "price": "55000.54",
            "type" : "sell"
        },
        {
            "id": 13,
            "name": "Sciarpa scolorita",
            "category": "Ropa",
            "price": "5.23",
            "type" : "sell"
        },
        {
            "id": 14,
            "name": "Lampada",
            "category": "Casa",
            "price": "70.65",
            "type" : "sell"
        },
        {
            "id": 15,
            "name": "Concime",
            "category": "Jardineria",
            "price": "2.45",
            "type" : "search"
        },
        {
            "id": 16,
            "name": "Basso nuovo",
            "category": "Musica",
            "price": "300.62",
            "type" : "sell"
        },
        {
            "id": 17,
            "name": "Cuffie Sony",
            "category": "Electronica",
            "price": "120.65",
            "type" : "sell"
        },
        {
            "id": 18,
            "name": "Ducati Monster",
            "category": "Coche",
            "price": "12000.13",
            "type" : "sell"
        },
        {
            "id": 19,
            "name": "Pattini",
            "category": "Deporte",
            "price": "90.64",
            "type" : "search"
        },
    
        {
            "id": 21,
            "name": "Guanti invernali",
            "category": "Ropa",
            "price": "22.04",
            "type" : "sell"
        },
        {
            "id": 22,
            "name": "Scrivania in vetro",
            "category": "Casa",
            "price": "600.63",
            "type" : "search"
        },
        {
            "id": 23,
            "name": "Secchio",
            "category": "Jardineria",
            "price": "30.43",
            "type" : "search"
        },
        {
            "id": 24,
            "name": "Compilation Pupo",
            "category": "Musica",
            "price": "9.93",
            "type" : "search"
        },
        {
            "id": 25,
            "name": "Auricolari Sennheiser",
            "category": "Electronica",
            "price": "120.93",
            "type" : "sell"
        },
        {
            "id": 26,
            "name": "Fiat 300",
            "category": "Coche",
            "price": "2560.42",
            "type" : "sell"
        },
        {
            "id": 27,
            "name": "Set mazze da golf",
            "category": "Deporte",
            "price": "4320.43",
            "type" : "search"
        },
        {
            "id": 28,
            "name": "Posto augo",
            "category": "Casa",
            "price": "2200.63",
            "type" : "search"
        },
        {
            "id": 29,
            "name": "Zaino Decathlon",
            "category": "Ropa",
            "price": "55.55",
            "type" : "sell"
        },
        {
            "id": 30,
            "name": "Comodino",
            "category": "Casa",
            "price": "210.12",
            "type" : "sell"
        },
        {
            "id": 31,
            "name": "Rastrello",
            "category": "Jardineria",
            "price": "5.62",
            "type" : "sell"
        },
        {
            "id": 32,
            "name": "Compilation Nino D'Angelo",
            "category": "Musica",
            "price": "1.91",
            "type" : "sell"
        },
        {
            "id": 33,
            "name": "IPhone X",
            "category": "Electronica",
            "price": "1300.41",
            "type" : "search"
        },
        {
            "id": 34,
            "name": "Nissan Juke",
            "category": "Coche",
            "price": "25420.40",
            "type" : "sell"
        },
        {
            "id": 35,
            "name": "Guanti da palestra",
            "category": "Deporte",
            "price": "11.54",
            "type" : "search"
        },
    
        {
            "id": 37,
            "name": "Scarpe Nike",
            "category": "Ropa",
            "price": "240.33",
            "type" : "sell"
        },
        {
            "id": 38,
            "name": "Poltrona",
            "category": "Casa",
            "price": "420.66",
            "type" : "search"
        },
        {
            "id": 39,
            "name": "Semi",
            "category": "Jardineria",
            "price": "4.43",
            "type" : "sell"
        },
        {
            "id": 40,
            "name": "Biglietto Gods Of Metal",
            "category": "Musica",
            "price": "150.65",
            "type" : "search"
        },
        {
            "id": 41,
            "name": "Macbook Pro",
            "category": "Electronica",
            "price": "2340.37",
            "type" : "search"
        },
        {
            "id": 42,
            "name": "Dacia Duster",
            "category": "Coche",
            "price": "13350.73",
            "type" : "sell"
        },
        {
            "id": 43,
            "name": "Canoa",
            "category": "Deporte",
            "price": "520.03",
            "type" : "search"
        },
        {
            "id": 44,
            "name": "Cantina",
            "category": "Casa",
            "price": "20000.12",
            "type" : "sell"
        },
        {
            "id": 45,
            "name": "Jeans",
            "category": "Ropa",
            "price": "55.54",
            "type" : "sell"
        },
        {
            "id": 46,
            "name": "Lampadario",
            "category": "Casa",
            "price": "280.54",
            "type" : "sell"
        },
        {
            "id": 47,
            "name": "Trattore",
            "category": "Jardineria",
            "price": "12000.09",
            "type" : "sell"
        },
        {
            "id": 48,
            "name": "Plettro",
            "category": "Musica",
            "price": "0.99",
            "type" : "sell"
        },
        {
            "id": 49,
            "name": "Modem",
            "category": "Mimmo",
            "price": "2.99",
            "type" : "sell"
        }
    ]


let contenedorHome = document.querySelector('.anuncios_home')
let contenedorLista = document.querySelector('.lista_anuncios')
let cantidadAnuncios= anuncios.length
let contenedorCategorias= document.getElementById('categoriasAnuncios')
let btnFiltrar = document.getElementById('filtrar')
let buscador = document.getElementById('buscadorAnuncios')
let maxPrecio = document.getElementById('max')
let minPrecio = document.getElementById('min')
let ordenar = document.getElementById('ordenar')

function renderizarAnuncios(matriz, contenedor, limite){
    if(contenedor === null){
        return
    }
    matriz.forEach((element, i) => {
        if (i <= limite){
        let article= document.createElement('article')
        article.classList.add('articulo_anuncio')
        let disponible = true
        if (i % 2 === 0){
            disponible= false
        }
        article.innerHTML= `
            <img src="https://picsum.photos/560/340" alt="">
                <span class="anuncio_estado ${disponible === true? 'disponible' : 'vendido'}">
                ${disponible === true? 'Disponible' : 'Vendido'}</span>
                <div class="anuncio_texto">
                    <span class="precio_articulo">${element.price}$</span>
                    <div class="texto_top">
                        <h4>${element.name}</h4>
                        <span>${element.type}</span>
                    </div>
                    <div class="texto_botton">
                        <span class="categoria_anuncio">
                            <i class="fa fa-tag"></i>
                            ${element.category}
                            </span>
                            <span class="fecha_anuncio">
                                <i class="fa fa-calendar"></i>
                                ${element.id}/06/2023
                            </span>
                    </div>
                </div>
            `
            contenedor.appendChild(article)
        }
    })
}

function filtrarAnuncios(){
    let busquedaAnuncios = buscarAnuncio(anuncios)
    let categoriaAnuncios = categoriaAnuncio(busquedaAnuncios)

    let maxMinAnuncios = minMaxAnuncio(categoriaAnuncios)
    let anunciosOrdenados = ordenarAnuncio(maxMinAnuncios)
    limpiarAnuncios()
    renderizarAnuncios(anunciosOrdenados, contenedorLista, anunciosOrdenados.length)
    console.log(anunciosOrdenados.length)
}


function limpiarAnuncios(){
    let anuncios = document.querySelectorAll('article')
    anuncios.forEach(anuncio => {
        contenedorLista.removeChild(anuncio)
    })
}
function buscarAnuncio(matriz){
    let busqueda = buscador.value.toLowerCase()
    let anunciosFiltrados= []

    matriz.forEach(anuncio => {
        if(anuncio.name.toLowerCase().includes(busqueda)){
            anunciosFiltrados.push(anuncio)
        }
    })
    return anunciosFiltrados
}

function renderizarCategorias(){
    let categorias= new Set()
    anuncios.forEach(anuncio =>{
        let categoria = anuncio.category
        categorias.add(categoria)
    })
    
    let defaultOption = document.createElement('option');
    defaultOption.innerHTML = "Selecciona una categoría";
    defaultOption.selected = true;
    defaultOption.disabled = true;
    contenedorCategorias.appendChild(defaultOption);


    categorias.forEach(categoria =>{
        let option = document.createElement('option')
        option.innerHTML = categoria
        contenedorCategorias.appendChild(option)
    })
}
function minMaxAnuncio(matriz){
    let min = Number(minPrecio.value)
    let max = maxPrecio.value == '' ? Infinity : Number(maxPrecio.value)

    let anunciosFiltrados = matriz.filter(anuncio => {
        return Number(anuncio.price) >= min && Number(anuncio.price) <= max
    })
    return anunciosFiltrados
}

function categoriaAnuncio(matriz){
    let categoriaSeleccionada = contenedorCategorias.value
    let anunciosFiltrados = matriz.filter(anuncio => {
        return anuncio.category === categoriaSeleccionada || categoriaSeleccionada == 'defaultOption'
    })
    return anunciosFiltrados
}

function ordenarAnuncio(matriz){
    let tipoDeOrden = ordenar.value
    switch (tipoDeOrden) {
            case 'Más reciente':
                matriz = matriz.sort((a, b)=> a.id - b.id)
                return matriz
            
            case 'Más antiguo':
                matriz = matriz.sort((a, b)=> b.id - a.id)
                return matriz
            
            case 'A-Z':
                matriz = matriz.sort((a, b)=> {
                    let nombreA = a.name.toLowerCase()
                    let nombreB = b.name.toLowerCase()

                    if(nombreA < nombreB){
                        return -1
                    }
                    if(nombreA > nombreB){
                        return 1
                    }
                    return 0
                })
                return matriz
            
            case 'Z-A':
                matriz = matriz.sort((a, b)=> {
                    let nombreA = a.name.toLowerCase()
                    let nombreB = b.name.toLowerCase()

                    if(nombreA < nombreB){
                        return 1
                    }
                    if(nombreA > nombreB){
                        return -1
                    }
                    return 0
                })
                return matriz
            
            
            case 'Mayor precio':
                matriz = matriz.sort((a, b)=> b.price - a.price)
                return matriz
            
            
            case 'Menor precio':
                matriz = matriz.sort((a, b)=> a.price - b.price)
                return matriz
            
    
        default: 
            return matriz
        
    }
}

renderizarAnuncios(anuncios, contenedorHome, 5)
renderizarAnuncios(anuncios, contenedorLista, cantidadAnuncios)
renderizarCategorias()

btnFiltrar.addEventListener('click', filtrarAnuncios)